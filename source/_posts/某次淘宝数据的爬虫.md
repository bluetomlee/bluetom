title: "某次淘宝数据的爬虫"
date: 2016-01-12 18:48:44
tags:
---


```javascript
/*
* @Author: bluetom
* @Date:   2015-08-13 17:22:39
* @Last Modified by:   bluetom
*/

'use strict';

var request = require('request');
var fs = require('fs');
var async = require('async');
var path = require('path');
var last = 217;
var url = ['https://www.jiyoujia.com/youjia/linggang/list.json?currentPage=','&propertylist=&fmt=data&_output_charset=utf-8&_input_charset=utf-8&_ksTS=1439465281674_194'];
var header = {
    url: '',
    rejectUnauthorized: false,
    headers: {
    'Accept': 'text/javascript, application/javascript, application/ecmascript, application/x-ecmascript, */*; q=0.01',
    'Accept-Language': 'zh-CN\,zh\;q=0.8',
    'Cache-Control': 'no-cache',
    'Connection': 'keep-alive',
    'Cookie': 'tracknick=king; skt=66218f08050e4286; _tb_token_=5e033987be5e8; cookie2=1c0dde2f983d441f96eef90e61cbeda5; t=1372ce95ab71dae0672b7ccaa6082655; isg=385D95C26E8BC1689FC49DAC02C9D3A6; l=AsbGrk99MsO/Ju414F83FYwPlrJKAwrh',
    'Host': 'www.jiyoujia.com',
    'Pragma': 'no-cache',
    'RA-Sid': 'DCB52669-20150803-124436-62a01a-49556d',
    'RA-Ver': '3.0.7',
    'Referer': 'https://www.jiyoujia.com/youjia/linggang/list.htm?spm=5704.7717861.a2150p5.3.rX91PN',
    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.130 Safari/537.36',
    'X-Requested-With': 'XMLHttpRequest'

    }
};
var total = [];

for (var i = 1; i < last; i++) {
    total.push(i);
}

async.mapLimit(total, 2, function(index, callback){
    url.length > 2 ? url[1] = index : url.splice(1, 0, index);
    header.url = url.join('');
    request(header,function(err,res,body) {
      if(!err && res.statusCode == 200){
          console.log('正在下载第'+index+'页');
      }else {
          console.log('下载失败!')
      }
    }).pipe(fs.createWriteStream('txt/'+index+'.txt'))
    callback()
})

```
